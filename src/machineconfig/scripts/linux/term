
#!/usr/bin/env bash
set -euo pipefail

RANDOM_NAME=$(date +%s%N | sha256sum | head -c 16)
OP_DIR="$HOME/tmp_results/tmp_scripts/machineconfig"
OP_PROGRAM_PATH="$OP_DIR/${RANDOM_NAME}.sh"
export OP_PROGRAM_PATH

# ANSI color/style codes
BOLD="\033[1m"
RESET="\033[0m"
GREEN="\033[32m"
YELLOW="\033[33m"
BLUE="\033[34m"
RED="\033[31m"

timestamp=$(date -u +"%Y-%m-%d %H:%M:%SZ")

printf "%b\n" "${BOLD}${BLUE}üõ†Ô∏è  terminal ‚Äî running term${RESET}"
printf "%b\n" "${BLUE}Timestamp:${RESET} ${timestamp}"
printf "%b\n" "${BLUE}Op program path:${RESET} ${OP_PROGRAM_PATH}"

terminal "$@"

if [[ -f "$OP_PROGRAM_PATH" ]]; then
  printf "%b\n" "${GREEN}‚úÖ Found op program:${RESET} ${OP_PROGRAM_PATH}"
  bat --style=plain --paging=never "$OP_PROGRAM_PATH"
  printf "%b\n" "${GREEN}‚ñ∂ Running...${RESET}"
  . "$OP_PROGRAM_PATH"
  status=$?
  if [[ $status -eq 0 ]]; then
    printf "%b\n" "${GREEN}‚úÖ Completed successfully (exit ${status})${RESET}"
  else
    printf "%b\n" "${YELLOW}‚ö†Ô∏è  Program exited with status ${status}${RESET}"
  fi
else
  printf "%b\n" "${YELLOW}‚ö†Ô∏è  No op program found at: ${OP_PROGRAM_PATH}${RESET}"
fi
